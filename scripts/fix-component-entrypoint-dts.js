#!/usr/bin/env node

/**
 * Rewrites dist/component/index.d.ts with explicit exports.
 *
 * tsdown currently emits an import-only declaration file for the component
 * entrypoint. We patch it after build so package consumers get the same API
 * surface in types and runtime exports.
 */

import { writeFileSync } from "node:fs";
import { dirname, join } from "node:path";
import { fileURLToPath } from "node:url";

const __dirname = dirname(fileURLToPath(import.meta.url));
const outPath = join(__dirname, "..", "packages", "auth", "dist", "component", "index.d.ts");

const content = `// Auto-generated by scripts/fix-component-entrypoint-dts.js â€” do not edit.
export { Auth as AuthFactory } from "../server/implementation/index.js";
export type {
  Tokens,
  Doc,
  SignInAction,
  SignOutAction,
} from "../server/implementation/index.js";
export { Auth, AuthCtx } from "../server/auth.js";
export type { AuthCtxConfig, InferAuth, UserDoc } from "../server/auth.js";
export type {
  ConvexAuthConfig,
  AuthProviderConfig,
  EmailConfig,
  EmailUserConfig,
  PhoneConfig,
  PhoneUserConfig,
  ConvexCredentialsConfig,
  GenericActionCtxWithAuthConfig,
  AuthProviderMaterializedConfig,
  ConvexAuthMaterializedConfig,
  ApiKeyConfig,
  KeyScope,
  ScopeChecker,
  KeyRecord,
  HttpKeyContext,
  CorsConfig,
  DeviceProviderConfig,
  GenericDoc,
} from "../server/types.js";
`;

writeFileSync(outPath, content);
console.log("Patched dist/component/index.d.ts exports");
